schemaVersion: 2.3.0
metadata:
  generateName: morey-tech-homelab
  version: 0.1.0
components:
  - name: devcontainer
    container:
      image: ghcr.io/morey-tech/homelab/devcontainer:latest
      memoryRequest: 2Gi
      memoryLimit: 4Gi
      cpuRequest: 2000m
      mountSources: true
      sourceMapping: /projects
commands:
  - id: setup-gh-auth
    exec:
      component: devcontainer
      commandLine: |
        #!/bin/bash
        echo "Setting up GitHub CLI authentication..."
        GITHUB_TOKEN=$(printf "protocol=https\nhost=github.com\n\n" | git credential fill 2>/dev/null | grep "^password=" | cut -d= -f2)
        if [ -n "$GITHUB_TOKEN" ]; then
          if echo "$GITHUB_TOKEN" | gh auth login --with-token 2>/dev/null; then
            echo "GitHub CLI authenticated successfully!"
            gh auth status
          else
            echo "Warning: Failed to authenticate gh CLI."
          fi
          unset GITHUB_TOKEN
        else
          echo "No GitHub credentials found. Skipping gh CLI authentication."
        fi
events:
  postStart:
    - setup-gh-auth
